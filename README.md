# TinderVK2110
Программа - чат-бот для поиска людей для знакомства в социальной сети Вконтакте. Запуск чат-бота происходит в сообществе VK Tinder2110 - [*https://vk.com/club222602838*](https://vk.com/club222602838)
## Чек-лист для запуска 
1. У вас установлен Python 3.x и любая IDE.
2. У вас создана база Postgresql.
## Инструкция по запуску
1. Внесите свои данные в config.ini *([Vk_user] - ключ пользователя VK API, [Db] - логин, пароль и название базы в Postgresql)*
2. Установите библиотеки, указанные в requirements.txt *(команда в консоле - pip install requirements.txt)*
## Алгоритм работы программы
1. В базе данных (БД) создаются отношения:
- User с атрибутами vk_id, first_name, last_name, age, sex, city;
- Partner с атрибутами vk_id, first_name, last_name, link, photo;
- User_Partner с атрибутами id, user_id, partner_id, seen, like.

Для реализации связи многие ко многим создаются взаимосвязи между отношениями User - User_partner по ключу vk_id (user_id) и Partner - User_partner по ключу vk_id (partner_id).
2. При первом отправлении сообщения чат-боту реализована кнопка "Начать", при нажатии этой кнопки, инициируется вызов метода ***send_keyboard*** (класс VkChatBot, модуль vk_chat_bot.py), который отправляет пользователю клавиатуру с 3-мя кнопками - команды "find", "like", "list".

При дальнейшем обращении юзера к боту сообщениями отличными от этих команд, так же вызывается этот метод.
3. При отправлении команды "find" юзером чат-боту происходит:
- проверка нахождения юзера в БД с помощью метода ***user_in_db*** (класс Database, модуль database.py), возвращает True при наличии юзера в БД, False при его отсутствии.
  - Если юзера нет в БД, то:
    - вызывается метод ***get_user_info*** (класс VkFindData, модуль vk_find_data.py), который возвращает словарь с данными юзера.
    - вызывается метод ***search_partners*** (класс VkFindData, модуль vk_find_data.py), который возвращает список словарей с данными людей, удовлетворяющих условиям: противоположный пол, возраст +/- 25%, тот же город. Если какое-то поле для поиска не указано у юзера, то в поиске партнеров оно не участвует.
    - вызывается метод ***add_user_partners*** (класс Database, модуль database.py), который заполняет значениями отношения в БД данными юзера и его найденных партнеров. Атрибутам seen (отвечает за просмотр партнера), like (отвечает за помещение партнера в список избранных) отношения User_partner присваивается значение "0".
  - Если юзер уже в БД, то:
    - вызывается метод ***take_partner*** (класс Database, модуль database.py), который возвращает данные первого не просмотренного партнера.
    - вызывается метод ***change_seen*** (класс Database, модуль database.py), который изменяет атрибут seen отношения User_partner на "1".
- проверка наличия не просмотренных партнеров у юзера с помощью метода ***all_seen*** (класс Database, модуль database.py), возвращает True, если все партнеры юзера просмотрены, False, если есть партнеры с атрибутом seen равным "0".
  - Если все партнеры просмотрены, то:
    - вызывается метод ***delete_seen*** (класс Database, модуль database.py), который присваивает артибуту seen всем партнерам юзера значение "0".
- вызывается метод ***take_partner*** (класс Database, модуль database.py), который возвращает данные первого не просмотренного партнера.
- вызывается метод ***search_photos*** (класс VkFindData, модуль vk_find_data.py), который возвращает список photo_id топ-3 фото по лайками профиля партнера. Если в профиле фото меньше 3, то возвращает соответствующее кол-во.
- вызывается метод ***add_photo_id*** (класс Database, модуль database.py), который присваивает атрибуту photo_id отношения Partner список photo_id.
- вызывается метод ***write_partner*** (класс VkChatBot, модуль vk_chat_bot.py), который отправляет в чат юзеру информацию и фото по партнеру.
4. При отправлении команды "like" юзером чат-боту происходит:
- проверка нахождения юзера в БД с помощью метода ***user_in_db*** (класс Database, модуль database.py), возвращает True при наличии юзера в БД, False при его отсутствии.
  - Если юзер в БД, то:
    - происходит проверка наличия like у последнего просматриваемого партнера с помощью метода ***change_like*** (класс Database, модуль database.py), который возвращает True, если последний просматриваемый партнер уже был помещен в список избранных и, если последний просматриваемый партнер не был помещен в список избранных, возвращает False, так же меняя значение атрибута like на "1".
      - если последний просматриваемый партнер был с атрибутом like = "1" до проверки, то:
        - вызывается метод ***write_msg*** (класс VkChatBot, модуль vk_chat_bot.py), который отправляет в чат сообщение юзеру, что партнер уже в списке избранных и необходимо выполнить команду find или list.
      - если последний просматриваемый партнер был с атрибутом like = "0" до проверки, то:
        - вызывается метод ***take_partner*** (класс Database, модуль database.py), который возвращает данные первого не просмотренного партнера.
        - вызывается метод ***write_msg*** (класс VkChatBot, модуль vk_chat_bot.py), который отправляет в чат сообщение юзеру, что партнер с такими-то именем и фамилией добавлен в список избранных.
  - Если юзера нет в БД:
    - вызывается метод ***write_msg*** (класс VkChatBot, модуль vk_chat_bot.py), который отправляет в чат сообщение юзеру, что необходимо выполнить команду find.
5. При отправлении команды "list" юзером чат-боту происходит:
- проверка нахождения юзера в БД с помощью метода ***user_in_db*** (класс Database, модуль database.py), возвращает True при наличии юзера в БД, False при его отсутствии.
  - Если юзер в БД, то:
    - вызывается метод ***get_like_list*** (класс Database, модуль database.py), который возвращает список словарей с данными избранных партнеров.
    - вызывается метод ***write_msg*** (класс VkChatBot, модуль vk_chat_bot.py), который отправляет в чат сообщение юзеру со всеми избранными партнерами.
  - Если юзера нет в БД:
    - вызывается метод ***write_msg*** (класс VkChatBot, модуль vk_chat_bot.py), который отправляет в чат сообщение юзеру, что необходимо выполнить команду find.
## Разработчики
1. Александр Борискин - FPY-83, https://github.com/ablsft
2. Алексей Нуштаев, https://github.com/AlekseyNushtaev
3. Ксения Восквицова FPY-83, https://github.com/KseniyaVKS